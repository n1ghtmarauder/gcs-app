<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GCS Operations | Guinea Cargo Services</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --primary: #1a5f4a;
      --primary-light: #238b6a;
      --primary-dark: #0f3d2f;
      --accent: #e8a838;
      --accent-hover: #d4952e;
      --danger: #c44536;
      --danger-light: #f8d7d4;
      --success: #2e7d5a;
      --success-light: #d4edda;
      --warning: #e8a838;
      --warning-light: #fff3cd;
      --bg-dark: #0d1f1a;
      --bg-main: #f7f9f8;
      --bg-card: #ffffff;
      --text-primary: #1a2e28;
      --text-secondary: #5a6b65;
      --text-muted: #8a9a94;
      --border: #d8e0dc;
      --border-light: #e8eeeb;
      --shadow-sm: 0 1px 3px rgba(26,95,74,0.08);
      --shadow-md: 0 4px 12px rgba(26,95,74,0.1);
      --shadow-lg: 0 8px 30px rgba(26,95,74,0.12);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg-main);
      color: var(--text-primary);
      min-height: 100vh;
    }

    /* Login Screen */
    .login-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--bg-dark) 0%, var(--primary-dark) 100%);
      padding: 20px;
    }

    .login-container {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      width: 100%;
      max-width: 420px;
      overflow: hidden;
    }

    .login-header {
      background: var(--bg-dark);
      padding: 32px;
      text-align: center;
    }

    .login-logo {
      margin-bottom: 16px;
    }

    .login-logo svg {
      filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3));
    }

    .login-header h1 {
      font-size: 22px;
      color: #fff;
      margin-bottom: 4px;
      line-height: 1.3;
    }

    .login-header h1 span {
      color: var(--accent);
    }

    .login-header p {
      color: rgba(255,255,255,0.6);
      font-size: 13px;
      font-family: 'Space Mono', monospace;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .login-body {
      padding: 32px;
    }

    .login-body h2 {
      font-size: 20px;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .login-body .subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }

    .login-tabs {
      display: flex;
      gap: 4px;
      background: var(--bg-main);
      padding: 4px;
      border-radius: var(--radius-md);
      margin-bottom: 24px;
    }

    .login-tab {
      flex: 1;
      padding: 10px;
      border: none;
      background: transparent;
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }

    .login-tab.active {
      background: var(--bg-card);
      color: var(--primary);
      box-shadow: var(--shadow-sm);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s;
      background: var(--bg-card);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26,95,74,0.1);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      font-family: inherit;
      width: 100%;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--primary-light);
    }

    .btn-primary:disabled {
      background: var(--border);
      cursor: not-allowed;
    }

    .btn-secondary {
      background: var(--bg-main);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-sm {
      padding: 8px 16px;
      font-size: 13px;
    }

    .error-message {
      background: var(--danger-light);
      color: var(--danger);
      padding: 12px 16px;
      border-radius: var(--radius-md);
      font-size: 13px;
      margin-bottom: 20px;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    .success-message {
      background: var(--success-light);
      color: var(--success);
      padding: 12px 16px;
      border-radius: var(--radius-md);
      font-size: 13px;
      margin-bottom: 20px;
      display: none;
    }

    .success-message.show {
      display: block;
    }

    .login-footer {
      text-align: center;
      padding-top: 20px;
      border-top: 1px solid var(--border-light);
      margin-top: 20px;
    }

    .login-footer p {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .login-footer a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }

    /* Loading Spinner */
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* App Container - Hidden until logged in */
    .app-container {
      display: none;
    }

    .app-container.show {
      display: block;
    }

    .login-screen.hidden {
      display: none;
    }

    /* Rest of existing styles */
    .sidebar {
      position: fixed;
      left: 0; top: 0; bottom: 0;
      width: 260px;
      background: var(--bg-dark);
      padding: 24px 0;
      z-index: 100;
      display: flex;
      flex-direction: column;
    }

    .logo {
      padding: 20px 24px 28px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon svg {
      display: block;
    }

    .logo-text h1 { font-size: 20px; font-weight: 700; color: #fff; letter-spacing: -0.5px; }
    .logo-text span { color: var(--accent); }
    .logo-text p { font-size: 10px; color: rgba(255,255,255,0.5); margin-top: 2px; font-family: 'Space Mono', monospace; text-transform: uppercase; letter-spacing: 1px; }

    .nav-section { padding: 0 12px; margin-bottom: 24px; }
    .nav-section-title { font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px; color: rgba(255,255,255,0.35); padding: 0 12px 12px; font-weight: 600; }

    .nav-item {
      display: flex; align-items: center; gap: 12px;
      padding: 12px 16px; color: rgba(255,255,255,0.7);
      text-decoration: none; border-radius: var(--radius-md);
      transition: all 0.2s; cursor: pointer; font-size: 14px; font-weight: 500;
    }
    .nav-item:hover { background: rgba(255,255,255,0.08); color: #fff; }
    .nav-item.active { background: var(--primary); color: #fff; }
    .nav-item svg { width: 20px; height: 20px; opacity: 0.8; }
    .nav-item.active svg { opacity: 1; }

    .nav-badge {
      margin-left: auto; background: var(--accent); color: var(--bg-dark);
      font-size: 11px; font-weight: 700; padding: 2px 8px; border-radius: 10px;
    }

    .sidebar-footer { margin-top: auto; padding: 24px; border-top: 1px solid rgba(255,255,255,0.1); }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--primary);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
    }

    .user-details {
      flex: 1;
      min-width: 0;
    }

    .user-details .name {
      font-size: 13px;
      font-weight: 600;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .user-details .email {
      font-size: 11px;
      color: rgba(255,255,255,0.5);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .logout-btn {
      width: 100%;
      padding: 10px;
      background: rgba(255,255,255,0.1);
      border: none;
      border-radius: var(--radius-md);
      color: rgba(255,255,255,0.7);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .logout-btn:hover {
      background: rgba(255,255,255,0.15);
      color: #fff;
    }

    .shipment-status { background: rgba(232,168,56,0.15); border-radius: var(--radius-md); padding: 16px; margin-top: 16px; }
    .shipment-status h4 { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--accent); margin-bottom: 8px; }
    .shipment-status p { font-size: 13px; color: rgba(255,255,255,0.8); line-height: 1.5; }
    .shipment-status .date { font-family: 'Space Mono', monospace; color: #fff; font-weight: 700; }

    .main { margin-left: 260px; min-height: 100vh; }

    .header {
      background: var(--bg-card); border-bottom: 1px solid var(--border);
      padding: 20px 32px; display: flex; align-items: center; justify-content: space-between;
      position: sticky; top: 0; z-index: 50;
    }
    .header-left h2 { font-size: 22px; font-weight: 700; color: var(--text-primary); }
    .header-left p { font-size: 13px; color: var(--text-secondary); margin-top: 2px; }
    .header-actions { display: flex; gap: 12px; }

    .btn { width: auto; }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: var(--shadow-md); }
    .btn-secondary:hover { background: var(--border-light); }
    .btn-accent { background: var(--accent); color: var(--bg-dark); }

    .content { padding: 32px; }

    .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px; }

    .stat-card {
      background: var(--bg-card); border-radius: var(--radius-lg);
      padding: 24px; border: 1px solid var(--border-light);
      box-shadow: var(--shadow-sm); transition: all 0.2s;
    }
    .stat-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
    .stat-card.highlight { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); border: none; }
    .stat-card.highlight .stat-label, .stat-card.highlight .stat-value, .stat-card.highlight .stat-change { color: #fff; }

    .stat-icon {
      width: 44px; height: 44px; border-radius: var(--radius-md);
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 16px; background: var(--bg-main);
    }
    .stat-card.highlight .stat-icon { background: rgba(255,255,255,0.2); }
    .stat-icon svg { width: 22px; height: 22px; color: var(--primary); }
    .stat-card.highlight .stat-icon svg { color: #fff; }

    .stat-label { font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 500; }
    .stat-value { font-size: 28px; font-weight: 700; color: var(--text-primary); font-family: 'Space Mono', monospace; }
    .stat-change { font-size: 12px; margin-top: 8px; display: flex; align-items: center; gap: 4px; }
    .stat-change.positive { color: var(--success); }

    .card {
      background: var(--bg-card); border-radius: var(--radius-lg);
      border: 1px solid var(--border-light); box-shadow: var(--shadow-sm); overflow: hidden;
    }
    .card-header {
      padding: 20px 24px; border-bottom: 1px solid var(--border-light);
      display: flex; align-items: center; justify-content: space-between;
    }
    .card-header h3 { font-size: 16px; font-weight: 600; }
    .card-body { padding: 24px; }

    .table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    th {
      text-align: left; padding: 14px 16px; font-size: 11px;
      text-transform: uppercase; letter-spacing: 1px; color: var(--text-secondary);
      font-weight: 600; background: var(--bg-main); border-bottom: 1px solid var(--border);
    }
    td { padding: 16px; font-size: 14px; border-bottom: 1px solid var(--border-light); vertical-align: middle; }
    tr:hover { background: var(--bg-main); }

    .customer-cell { display: flex; align-items: center; gap: 12px; }
    .customer-avatar {
      width: 36px; height: 36px; border-radius: 50%;
      background: var(--primary); color: #fff;
      display: flex; align-items: center; justify-content: center;
      font-weight: 600; font-size: 13px;
    }
    .customer-info .name { font-weight: 600; color: var(--text-primary); }
    .customer-info .id { font-size: 12px; color: var(--text-muted); font-family: 'Space Mono', monospace; }

    .status-badge {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;
    }
    .status-badge.pending { background: var(--warning-light); color: #856404; }
    .status-badge.received { background: var(--success-light); color: var(--success); }
    .status-badge.shipped { background: #e3f2fd; color: #1565c0; }
    .status-badge.delivered { background: var(--primary); color: #fff; }
    .status-badge.staging { background: var(--warning-light); color: #856404; }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; }

    .weight-cell { font-family: 'Space Mono', monospace; font-weight: 600; }
    .value-cell { font-family: 'Space Mono', monospace; color: var(--success); font-weight: 600; }

    .actions-cell { display: flex; gap: 8px; }
    .action-btn {
      width: 32px; height: 32px; border-radius: var(--radius-sm);
      border: 1px solid var(--border); background: var(--bg-card);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }
    .action-btn:hover { background: var(--primary); border-color: var(--primary); color: #fff; }
    .action-btn.danger:hover { background: var(--danger); border-color: var(--danger); }
    .action-btn svg { width: 16px; height: 16px; }

    .grid-2 { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-top: 24px; }

    .modal-overlay {
      position: fixed; inset: 0; background: rgba(13,31,26,0.6);
      backdrop-filter: blur(4px); z-index: 200;
      display: none; align-items: center; justify-content: center; padding: 20px;
    }
    .modal-overlay.active { display: flex; }

    .modal {
      background: var(--bg-card); border-radius: var(--radius-lg);
      width: 100%; max-width: 700px; max-height: 90vh; overflow: hidden;
      box-shadow: var(--shadow-lg); animation: modalIn 0.3s ease;
    }
    @keyframes modalIn {
      from { opacity: 0; transform: translateY(20px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .modal-header {
      padding: 24px; border-bottom: 1px solid var(--border-light);
      display: flex; align-items: center; justify-content: space-between;
    }
    .modal-header h3 { font-size: 18px; font-weight: 700; }

    .modal-close {
      width: 36px; height: 36px; border-radius: 50%; border: none;
      background: var(--bg-main); cursor: pointer;
      display: flex; align-items: center; justify-content: center; transition: all 0.2s;
    }
    .modal-close:hover { background: var(--danger-light); color: var(--danger); }

    .modal-body { padding: 24px; overflow-y: auto; max-height: calc(90vh - 160px); }

    .modal-footer {
      padding: 20px 24px; border-top: 1px solid var(--border-light);
      display: flex; justify-content: flex-end; gap: 12px; background: var(--bg-main);
    }

    .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
    .form-group.full-width { grid-column: span 2; }
    .form-label .required { color: var(--danger); }

    textarea.form-input { resize: vertical; min-height: 100px; }

    .section-divider { display: flex; align-items: center; gap: 16px; margin: 24px 0; }
    .section-divider span {
      font-size: 12px; font-weight: 600; color: var(--text-secondary);
      text-transform: uppercase; letter-spacing: 1px; white-space: nowrap;
    }
    .section-divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }

    .items-list { display: flex; flex-direction: column; gap: 12px; }
    .item-row {
      display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 12px;
      align-items: start; padding: 16px; background: var(--bg-main);
      border-radius: var(--radius-md); border: 1px solid var(--border-light);
    }
    .item-row .form-input { padding: 10px 12px; font-size: 13px; }

    .remove-item-btn {
      width: 36px; height: 36px; border-radius: var(--radius-sm);
      border: 1px solid var(--danger-light); background: var(--bg-card);
      color: var(--danger); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s; margin-top: 24px;
    }
    .remove-item-btn:hover { background: var(--danger); border-color: var(--danger); color: #fff; }

    .add-item-btn {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      padding: 14px; border: 2px dashed var(--border); border-radius: var(--radius-md);
      background: transparent; color: var(--text-secondary);
      font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; font-family: inherit;
    }
    .add-item-btn:hover { border-color: var(--primary); color: var(--primary); background: rgba(26,95,74,0.05); }

    .activity-list { display: flex; flex-direction: column; }
    .activity-item { display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px solid var(--border-light); }
    .activity-item:last-child { border-bottom: none; }

    .activity-icon {
      width: 40px; height: 40px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }
    .activity-icon.green { background: var(--success-light); color: var(--success); }
    .activity-icon.blue { background: #e3f2fd; color: #1565c0; }
    .activity-icon.orange { background: var(--warning-light); color: #856404; }
    .activity-content { flex: 1; }
    .activity-content p { font-size: 14px; color: var(--text-primary); line-height: 1.5; }
    .activity-content p strong { font-weight: 600; }
    .activity-time { font-size: 12px; color: var(--text-muted); margin-top: 4px; }

    .totals-row {
      display: flex; justify-content: flex-end; gap: 32px;
      padding: 20px 24px; background: var(--bg-main); border-top: 2px solid var(--border);
    }
    .total-item { text-align: right; }
    .total-item label { font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
    .total-item .value { font-size: 20px; font-weight: 700; font-family: 'Space Mono', monospace; color: var(--text-primary); }
    .total-item .value.primary { color: var(--primary); }

    .page { display: none; }
    .page.active { display: block; }

    .inventory-filters { display: flex; gap: 12px; margin-bottom: 20px; }
    .filter-select {
      padding: 8px 16px; border: 1px solid var(--border);
      border-radius: var(--radius-md); font-size: 13px; font-family: inherit;
      background: var(--bg-card); cursor: pointer;
    }

    .search-box { position: relative; }
    .search-box input { padding-left: 44px; width: 280px; }
    .search-box svg { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; color: var(--text-muted); }

    .tabs { display: flex; gap: 4px; padding: 4px; background: var(--bg-main); border-radius: var(--radius-md); margin-bottom: 24px; }
    .tab {
      padding: 10px 20px; border-radius: var(--radius-sm); font-size: 14px;
      font-weight: 500; color: var(--text-secondary); cursor: pointer;
      transition: all 0.2s; border: none; background: transparent; font-family: inherit;
    }
    .tab:hover { color: var(--text-primary); }
    .tab.active { background: var(--bg-card); color: var(--primary); box-shadow: var(--shadow-sm); }

    .declaration-preview {
      background: #fffef5; border: 1px solid #e8e0c0;
      border-radius: var(--radius-md); padding: 24px;
      font-family: 'Space Mono', monospace; font-size: 12px;
    }
    .declaration-preview h4 { font-size: 14px; margin-bottom: 16px; text-align: center; border-bottom: 1px solid #e8e0c0; padding-bottom: 12px; }
    .declaration-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px dotted #e8e0c0; }
    .declaration-row:last-child { border-bottom: none; font-weight: 700; margin-top: 12px; padding-top: 12px; border-top: 2px solid #e8e0c0; }

    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(255,255,255,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .loading-overlay .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--primary);
    }

    .loading-overlay.hidden {
      display: none;
    }

    @media (max-width: 1200px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .grid-2 { grid-template-columns: 1fr; }
    }
    @media (max-width: 768px) {
      .sidebar { transform: translateX(-100%); }
      .main { margin-left: 0; }
      .stats-grid { grid-template-columns: 1fr; }
      .form-grid { grid-template-columns: 1fr; }
      .form-group.full-width { grid-column: span 1; }
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
  </div>

  <!-- Login Screen -->
  <div class="login-screen" id="loginScreen">
    <div class="login-container">
      <div class="login-header">
        <div class="login-logo">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="80" height="80">
            <defs>
              <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#1a5f4a"/>
                <stop offset="100%" style="stop-color:#0f3d2f"/>
              </linearGradient>
              <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#e8a838"/>
                <stop offset="100%" style="stop-color:#d4952e"/>
              </linearGradient>
            </defs>
            <circle cx="100" cy="100" r="95" fill="url(#bgGrad)"/>
            <circle cx="100" cy="100" r="88" fill="none" stroke="url(#goldGrad)" stroke-width="2"/>
            <g transform="translate(100, 85)">
              <rect x="-40" y="-20" width="80" height="45" rx="3" fill="#fff" opacity="0.95"/>
              <line x1="-25" y1="-20" x2="-25" y2="25" stroke="#1a5f4a" stroke-width="2"/>
              <line x1="-10" y1="-20" x2="-10" y2="25" stroke="#1a5f4a" stroke-width="2"/>
              <line x1="5" y1="-20" x2="5" y2="25" stroke="#1a5f4a" stroke-width="2"/>
              <line x1="20" y1="-20" x2="20" y2="25" stroke="#1a5f4a" stroke-width="2"/>
              <line x1="35" y1="-20" x2="35" y2="25" stroke="#1a5f4a" stroke-width="2"/>
              <path d="M -35 2 L 30 2 L 30 -5 L 45 7 L 30 19 L 30 12 L -35 12 Z" fill="url(#goldGrad)" transform="translate(0, -25) scale(0.6)"/>
            </g>
            <path d="M 30 130 Q 50 120 70 130 Q 90 140 110 130 Q 130 120 150 130 Q 170 140 190 130" fill="none" stroke="#fff" stroke-width="3" opacity="0.6"/>
            <path d="M 20 142 Q 40 132 60 142 Q 80 152 100 142 Q 120 132 140 142 Q 160 152 180 142" fill="none" stroke="#fff" stroke-width="2" opacity="0.4"/>
            <text x="100" y="178" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" font-size="24" fill="#fff">
              <tspan fill="#fff">GC</tspan><tspan fill="#e8a838">S</tspan>
            </text>
          </svg>
        </div>
        <h1>Guinea<br><span>Cargo Services</span></h1>
        <p>Operations Portal</p>
      </div>
      <div class="login-body">
        <div class="login-tabs">
          <button class="login-tab active" onclick="showLoginTab('signin')">Sign In</button>
          <button class="login-tab" onclick="showLoginTab('signup')">Sign Up</button>
        </div>

        <div id="errorMessage" class="error-message"></div>
        <div id="successMessage" class="success-message"></div>

        <!-- Sign In Form -->
        <form id="signinForm" onsubmit="handleSignIn(event)">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="signinEmail" placeholder="your email" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-input" id="signinPassword" placeholder="••••••••" required>
          </div>
          <button type="submit" class="btn btn-primary" id="signinBtn">
            <span>Sign In</span>
          </button>
        </form>

        <!-- Sign Up Form -->
        <form id="signupForm" style="display: none;" onsubmit="handleSignUp(event)">
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-input" id="signupName" placeholder="Your name" required>
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="signupEmail" placeholder="your email" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-input" id="signupPassword" placeholder="Min 6 characters" minlength="6" required>
          </div>
          <button type="submit" class="btn btn-primary" id="signupBtn">
            <span>Create Account</span>
          </button>
        </form>

        <div class="login-footer">
          <p>Guinea Cargo Services © 2026</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main App -->
  <div class="app-container" id="appContainer">
    <aside class="sidebar">
      <div class="logo">
        <div class="logo-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="44" height="44">
            <defs>
              <linearGradient id="sidebarBgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#1a5f4a"/>
                <stop offset="100%" style="stop-color:#0f3d2f"/>
              </linearGradient>
              <linearGradient id="sidebarGoldGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#e8a838"/>
                <stop offset="100%" style="stop-color:#d4952e"/>
              </linearGradient>
            </defs>
            <circle cx="100" cy="100" r="95" fill="url(#sidebarBgGrad)"/>
            <circle cx="100" cy="100" r="88" fill="none" stroke="url(#sidebarGoldGrad)" stroke-width="3"/>
            <g transform="translate(100, 85)">
              <rect x="-40" y="-20" width="80" height="45" rx="3" fill="#fff" opacity="0.95"/>
              <line x1="-25" y1="-20" x2="-25" y2="25" stroke="#1a5f4a" stroke-width="3"/>
              <line x1="-10" y1="-20" x2="-10" y2="25" stroke="#1a5f4a" stroke-width="3"/>
              <line x1="5" y1="-20" x2="5" y2="25" stroke="#1a5f4a" stroke-width="3"/>
              <line x1="20" y1="-20" x2="20" y2="25" stroke="#1a5f4a" stroke-width="3"/>
              <line x1="35" y1="-20" x2="35" y2="25" stroke="#1a5f4a" stroke-width="3"/>
            </g>
            <path d="M 30 135 Q 60 115 100 135 Q 140 155 170 135" fill="none" stroke="#fff" stroke-width="4" opacity="0.6"/>
          </svg>
        </div>
        <div class="logo-text">
          <h1>GC<span>S</span></h1>
          <p>Operations Portal</p>
        </div>
      </div>
      <nav class="nav-section">
        <div class="nav-section-title">Main Menu</div>
        <a class="nav-item active" data-page="dashboard">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/></svg>
          Dashboard
        </a>
        <a class="nav-item" data-page="customers">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
          Customers
          <span class="nav-badge" id="customerCount">0</span>
        </a>
        <a class="nav-item" data-page="inventory">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
          Inventory
          <span class="nav-badge" id="inventoryCount">0</span>
        </a>
        <a class="nav-item" data-page="shipments">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/></svg>
          Shipments
        </a>
      </nav>
      <nav class="nav-section">
        <div class="nav-section-title">Documents</div>
        <a class="nav-item" data-page="customs">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          Customs Docs
        </a>
      </nav>
      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <div class="user-details">
            <div class="name" id="userName">User</div>
            <div class="email" id="userEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="aadfd9cfd8eacfd2cbc7dac6cf84c9c5c7">[email&#160;protected]</a></div>
          </div>
        </div>
        <button class="logout-btn" onclick="handleLogout()">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
          Sign Out
        </button>
        <div class="shipment-status">
          <h4>Next Shipment</h4>
          <p>Container closes in</p>
          <p class="date">12 days</p>
        </div>
      </div>
    </aside>

    <main class="main">
      <!-- Dashboard Page -->
      <div class="page active" id="dashboard">
        <header class="header">
          <div class="header-left">
            <h2>Operations Dashboard</h2>
            <p>Welcome back! Here's what's happening with your shipments.</p>
          </div>
          <div class="header-actions">
            <button class="btn btn-secondary" onclick="openModal('newCustomerModal')">
              <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
              New Customer
            </button>
            <button class="btn btn-primary" onclick="openModal('newItemModal')">
              <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
              Add Items
            </button>
          </div>
        </header>
        <div class="content">
          <div class="stats-grid">
            <div class="stat-card highlight">
              <div class="stat-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
              </div>
              <div class="stat-label">Current Container</div>
              <div class="stat-value" id="statWeight">0 lbs</div>
              <div class="stat-change positive" id="statCapacity">↑ 0% capacity</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
              </div>
              <div class="stat-label">Active Customers</div>
              <div class="stat-value" id="statCustomers">0</div>
              <div class="stat-change positive">Ready to ship</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <div class="stat-label">Declared Value</div>
              <div class="stat-value" id="statValue">$0</div>
              <div class="stat-change positive">Current shipment</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
              </div>
              <div class="stat-label">Items Received</div>
              <div class="stat-value" id="statItems">0</div>
              <div class="stat-change positive">In staging</div>
            </div>
          </div>
          <div class="grid-2">
            <div class="card">
              <div class="card-header"><h3>Recent Customers</h3></div>
              <div class="table-container">
                <table>
                  <thead><tr><th>Customer</th><th>Items</th><th>Weight</th><th>Value</th><th>Status</th></tr></thead>
                  <tbody id="recentShipmentsTable"></tbody>
                </table>
              </div>
            </div>
            <div class="card">
              <div class="card-header"><h3>Recent Activity</h3></div>
              <div class="card-body">
                <div class="activity-list" id="activityList">
                  <p style="color: var(--text-muted); text-align: center; padding: 20px;">No recent activity</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Customers Page -->
      <div class="page" id="customers">
        <header class="header">
          <div class="header-left">
            <h2>Customer Management</h2>
            <p>Manage your customer database</p>
          </div>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="openModal('newCustomerModal')">
              <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
              Add Customer
            </button>
          </div>
        </header>
        <div class="content">
          <div class="card">
            <div class="table-container">
              <table>
                <thead><tr><th>Customer</th><th>Phone</th><th>Recipient</th><th>Items</th><th>Weight</th><th>Value</th><th>Actions</th></tr></thead>
                <tbody id="customersTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Inventory Page -->
      <div class="page" id="inventory">
        <header class="header">
          <div class="header-left">
            <h2>Inventory Management</h2>
            <p>Track all items staged for shipment</p>
          </div>
          <div class="header-actions">
            <button class="btn btn-secondary" onclick="exportInventory()">
              <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
              Export CSV
            </button>
            <button class="btn btn-primary" onclick="openModal('newItemModal')">
              <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
              Add Items
            </button>
          </div>
        </header>
        <div class="content">
          <div class="inventory-filters">
            <select class="filter-select" id="customerFilter"><option value="">All Customers</option></select>
            <select class="filter-select" id="statusFilter"><option value="">All Statuses</option><option value="received">Received</option><option value="staged">Staged</option><option value="shipped">Shipped</option></select>
            <select class="filter-select" id="categoryFilter"><option value="">All Categories</option><option value="electronics">Electronics</option><option value="clothing">Clothing</option><option value="furniture">Furniture</option><option value="appliances">Appliances</option><option value="household">Household</option><option value="other">Other</option></select>
          </div>
          <div class="card">
            <div class="table-container">
              <table>
                <thead><tr><th>Item ID</th><th>Customer</th><th>Description</th><th>Category</th><th>Weight</th><th>Value</th><th>Status</th><th>Actions</th></tr></thead>
                <tbody id="inventoryTable"></tbody>
              </table>
            </div>
            <div class="totals-row">
              <div class="total-item"><label>Total Items</label><div class="value" id="totalItems">0</div></div>
              <div class="total-item"><label>Total Weight</label><div class="value" id="totalWeight">0 lbs</div></div>
              <div class="total-item"><label>Total Value</label><div class="value primary" id="totalValue">$0</div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Shipments Page -->
      <div class="page" id="shipments">
        <header class="header">
          <div class="header-left">
            <h2>Shipment Management</h2>
            <p>Track container shipments</p>
          </div>
        </header>
        <div class="content">
          <div class="card">
            <div class="table-container">
              <table>
                <thead><tr><th>Shipment ID</th><th>Container</th><th>Customers</th><th>Items</th><th>Weight</th><th>Value</th><th>Departure</th><th>Status</th></tr></thead>
                <tbody id="shipmentsTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Customs Page -->
      <div class="page" id="customs">
        <header class="header">
          <div class="header-left">
            <h2>Customs Documentation</h2>
            <p>Generate customs declarations</p>
          </div>
        </header>
        <div class="content">
          <div class="grid-2">
            <div class="card">
              <div class="card-header"><h3>Select Customer</h3></div>
              <div class="card-body">
                <div class="form-group">
                  <label class="form-label">Customer</label>
                  <select class="form-input" id="declarationCustomer"><option value="">Select...</option></select>
                </div>
                <button class="btn btn-primary" style="margin-top: 16px;" onclick="previewDeclaration()">Preview Declaration</button>
              </div>
            </div>
            <div class="card">
              <div class="card-header"><h3>Preview</h3></div>
              <div class="card-body">
                <div class="declaration-preview" id="declarationPreview">
                  <h4>CUSTOMS DECLARATION</h4>
                  <p style="text-align:center;color:#666;">Select a customer</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- New Customer Modal -->
  <div class="modal-overlay" id="newCustomerModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Add New Customer</h3>
        <button class="modal-close" onclick="closeModal('newCustomerModal')">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-grid">
          <div class="form-group"><label class="form-label">First Name <span class="required">*</span></label><input type="text" class="form-input" id="customerFirstName" placeholder="First name"></div>
          <div class="form-group"><label class="form-label">Last Name <span class="required">*</span></label><input type="text" class="form-input" id="customerLastName" placeholder="Last name"></div>
          <div class="form-group"><label class="form-label">Phone <span class="required">*</span></label><input type="tel" class="form-input" id="customerPhone" placeholder="(206) 555-0123"></div>
          <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="customerEmail" placeholder="email"></div>
          <div class="form-group full-width"><label class="form-label">Address</label><input type="text" class="form-input" id="customerAddress" placeholder="Street address"></div>
          <div class="form-group"><label class="form-label">City</label><input type="text" class="form-input" id="customerCity" placeholder="City"></div>
          <div class="form-group"><label class="form-label">ZIP</label><input type="text" class="form-input" id="customerZip" placeholder="98101"></div>
        </div>
        <div class="section-divider"><span>Recipient in Guinea</span></div>
        <div class="form-grid">
          <div class="form-group"><label class="form-label">Recipient Name <span class="required">*</span></label><input type="text" class="form-input" id="recipientName" placeholder="Full name"></div>
          <div class="form-group"><label class="form-label">Recipient Phone</label><input type="text" class="form-input" id="recipientPhone" placeholder="+224 XXX XXX XXX"></div>
          <div class="form-group full-width"><label class="form-label">Delivery Address <span class="required">*</span></label><textarea class="form-input" id="recipientAddress" placeholder="Full address in Conakry"></textarea></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('newCustomerModal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveCustomer()">Save Customer</button>
      </div>
    </div>
  </div>

  <!-- New Item Modal -->
  <div class="modal-overlay" id="newItemModal">
    <div class="modal" style="max-width: 900px;">
      <div class="modal-header">
        <h3>Add Items</h3>
        <button class="modal-close" onclick="closeModal('newItemModal')">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-grid">
          <div class="form-group"><label class="form-label">Customer <span class="required">*</span></label><select class="form-input" id="itemCustomer"><option value="">Select...</option></select></div>
          <div class="form-group"><label class="form-label">Intake</label><select class="form-input" id="intakeMethod"><option value="dropoff">Drop-off</option><option value="mail">Mail-in</option><option value="pickup">Pickup</option></select></div>
        </div>
        <div class="section-divider"><span>Items</span></div>
        <div class="items-list" id="itemsList">
          <div class="item-row">
            <div class="form-group"><label class="form-label">Description <span class="required">*</span></label><input type="text" class="form-input item-desc" placeholder="Item description"></div>
            <div class="form-group"><label class="form-label">Category</label><select class="form-input item-category"><option value="electronics">Electronics</option><option value="clothing">Clothing</option><option value="furniture">Furniture</option><option value="appliances">Appliances</option><option value="household">Household</option><option value="other">Other</option></select></div>
            <div class="form-group"><label class="form-label">Weight (lbs)</label><input type="number" class="form-input item-weight" placeholder="0"></div>
            <div class="form-group"><label class="form-label">Value ($)</label><input type="number" class="form-input item-value" placeholder="0"></div>
            <button class="remove-item-btn" onclick="removeItemRow(this)" style="visibility:hidden;"><svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
          </div>
        </div>
        <button class="add-item-btn" onclick="addItemRow()">
          <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
          Add Another Item
        </button>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('newItemModal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveItems()">Save Items</button>
      </div>
    </div>
  </div>

  <script>
    // =====================================================
    // SUPABASE CONFIGURATION
    // =====================================================
    // IMPORTANT: Replace these with your Supabase project credentials
    // Get these from: https://supabase.com/dashboard/project/YOUR_PROJECT/settings/api
    
    const SUPABASE_URL = 'https://usxkawrvasiidlsludjc.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVzeGthd3J2YXNpaWRsc2x1ZGpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1Nzg5MjMsImV4cCI6MjA4NTE1NDkyM30.AAkyRqAywxkXv3aO0uNIf7RuG1lCxrcS89wHJKqlunQ';
    
    // Initialize Supabase client
    let supabase;
    let currentUser = null;
    let customers = [];
    let inventory = [];

    // Check if Supabase is configured
    function isSupabaseConfigured() {
      return SUPABASE_URL !== 'YOUR_SUPABASE_URL' && SUPABASE_ANON_KEY !== 'YOUR_SUPABASE_ANON_KEY';
    }

    // Initialize the app
    async function initApp() {
      if (isSupabaseConfigured()) {
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Check for existing session
        const { data: { session } } = await supabase.auth.getSession();
        if (session) {
          currentUser = session.user;
          showApp();
          await loadData();
        } else {
          hideLoading();
        }

        // Listen for auth changes
        supabase.auth.onAuthStateChange(async (event, session) => {
          if (event === 'SIGNED_IN' && session) {
            currentUser = session.user;
            showApp();
            await loadData();
          } else if (event === 'SIGNED_OUT') {
            currentUser = null;
            hideApp();
          }
        });
      } else {
        // Demo mode without Supabase
        console.warn('Supabase not configured. Running in demo mode.');
        hideLoading();
        loadDemoData();
      }
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.add('hidden');
    }

    function showApp() {
      hideLoading();
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('appContainer').classList.add('show');
      updateUserDisplay();
    }

    function hideApp() {
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('appContainer').classList.remove('show');
    }

    function updateUserDisplay() {
      if (currentUser) {
        const name = currentUser.user_metadata?.full_name || currentUser.email.split('@')[0];
        document.getElementById('userName').textContent = name;
        document.getElementById('userEmail').textContent = currentUser.email;
        document.getElementById('userAvatar').textContent = name.charAt(0).toUpperCase();
      }
    }

    // Login tab switching
    function showLoginTab(tab) {
      document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('signinForm').style.display = tab === 'signin' ? 'block' : 'none';
      document.getElementById('signupForm').style.display = tab === 'signup' ? 'block' : 'none';
      document.getElementById('errorMessage').classList.remove('show');
      document.getElementById('successMessage').classList.remove('show');
    }

    function showError(message) {
      const el = document.getElementById('errorMessage');
      el.textContent = message;
      el.classList.add('show');
      document.getElementById('successMessage').classList.remove('show');
    }

    function showSuccess(message) {
      const el = document.getElementById('successMessage');
      el.textContent = message;
      el.classList.add('show');
      document.getElementById('errorMessage').classList.remove('show');
    }

    // Authentication handlers
    async function handleSignIn(e) {
      e.preventDefault();
      const email = document.getElementById('signinEmail').value;
      const password = document.getElementById('signinPassword').value;
      const btn = document.getElementById('signinBtn');

      if (!isSupabaseConfigured()) {
        // Demo mode - just show the app
        currentUser = { email, user_metadata: { full_name: 'Demo User' } };
        showApp();
        loadDemoData();
        return;
      }

      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div>';

      const { data, error } = await supabase.auth.signInWithPassword({ email, password });

      btn.disabled = false;
      btn.innerHTML = '<span>Sign In</span>';

      if (error) {
        showError(error.message);
      }
    }

    async function handleSignUp(e) {
      e.preventDefault();
      const name = document.getElementById('signupName').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      const btn = document.getElementById('signupBtn');

      if (!isSupabaseConfigured()) {
        showError('Supabase not configured. Cannot create accounts in demo mode.');
        return;
      }

      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div>';

      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: { data: { full_name: name } }
      });

      btn.disabled = false;
      btn.innerHTML = '<span>Create Account</span>';

      if (error) {
        showError(error.message);
      } else {
        showSuccess('Account created! Check your email to confirm, then sign in.');
        showLoginTab('signin');
        document.querySelectorAll('.login-tab')[0].classList.add('active');
        document.querySelectorAll('.login-tab')[1].classList.remove('active');
      }
    }

    async function handleLogout() {
      if (isSupabaseConfigured()) {
        await supabase.auth.signOut();
      }
      currentUser = null;
      customers = [];
      inventory = [];
      hideApp();
      document.getElementById('loginScreen').classList.remove('hidden');
    }

    // Data loading
    async function loadData() {
      if (!isSupabaseConfigured()) return;

      // Load customers
      const { data: custData } = await supabase
        .from('customers')
        .select('*')
        .order('created_at', { ascending: false });
      customers = custData || [];

      // Load inventory
      const { data: invData } = await supabase
        .from('inventory')
        .select('*')
        .order('created_at', { ascending: false });
      inventory = invData || [];

      updateAll();
    }

    function loadDemoData() {
      customers = [
        { id: 1, customer_id: 'GCS-2026-001', first_name: 'Mamadou', last_name: 'Diallo', phone: '(206) 555-0123', email: '', recipient_name: 'Fatoumata Diallo', recipient_address: 'Quartier Madina, Conakry' },
        { id: 2, customer_id: 'GCS-2026-002', first_name: 'Aissatou', last_name: 'Barry', phone: '(253) 555-0456', email: '', recipient_name: 'Ibrahima Barry', recipient_address: 'Quartier Cosa, Conakry' },
      ];
      inventory = [
        { id: 1, item_id: 'INV-001', customer_id: 'GCS-2026-001', description: 'Samsung 55" LED TV', category: 'electronics', weight: 42, value: 350, status: 'received' },
        { id: 2, item_id: 'INV-002', customer_id: 'GCS-2026-001', description: 'iPhone 15 Pro Max', category: 'electronics', weight: 1, value: 1100, status: 'received' },
        { id: 3, item_id: 'INV-003', customer_id: 'GCS-2026-002', description: 'HP Laptop', category: 'electronics', weight: 8, value: 650, status: 'received' },
      ];
      updateAll();
    }

    // Save customer
    async function saveCustomer() {
      const customer = {
        customer_id: `GCS-2026-${String(customers.length + 1).padStart(3, '0')}`,
        first_name: document.getElementById('customerFirstName').value,
        last_name: document.getElementById('customerLastName').value,
        phone: document.getElementById('customerPhone').value,
        email: document.getElementById('customerEmail').value,
        address: document.getElementById('customerAddress').value,
        city: document.getElementById('customerCity').value,
        zip: document.getElementById('customerZip').value,
        recipient_name: document.getElementById('recipientName').value,
        recipient_phone: document.getElementById('recipientPhone').value,
        recipient_address: document.getElementById('recipientAddress').value,
      };

      if (!customer.first_name || !customer.last_name || !customer.phone || !customer.recipient_name || !customer.recipient_address) {
        alert('Please fill in all required fields');
        return;
      }

      if (isSupabaseConfigured()) {
        const { data, error } = await supabase.from('customers').insert([customer]).select();
        if (error) { alert('Error: ' + error.message); return; }
        customers.unshift(data[0]);
      } else {
        customer.id = customers.length + 1;
        customers.unshift(customer);
      }

      closeModal('newCustomerModal');
      document.querySelectorAll('#newCustomerModal input, #newCustomerModal textarea').forEach(i => i.value = '');
      updateAll();
    }

    // Save items
    async function saveItems() {
      const customerId = document.getElementById('itemCustomer').value;
      if (!customerId) { alert('Please select a customer'); return; }

      const rows = document.querySelectorAll('.item-row');
      const newItems = [];

      rows.forEach(row => {
        const desc = row.querySelector('.item-desc').value;
        const cat = row.querySelector('.item-category').value;
        const weight = parseFloat(row.querySelector('.item-weight').value) || 0;
        const value = parseFloat(row.querySelector('.item-value').value) || 0;
        if (desc) {
          newItems.push({
            item_id: `INV-${String(inventory.length + newItems.length + 1).padStart(3, '0')}`,
            customer_id: customerId,
            description: desc,
            category: cat,
            weight,
            value,
            status: 'received'
          });
        }
      });

      if (newItems.length === 0) { alert('Please add at least one item'); return; }

      if (isSupabaseConfigured()) {
        const { data, error } = await supabase.from('inventory').insert(newItems).select();
        if (error) { alert('Error: ' + error.message); return; }
        inventory = [...data, ...inventory];
      } else {
        newItems.forEach((item, i) => { item.id = inventory.length + i + 1; });
        inventory = [...newItems, ...inventory];
      }

      closeModal('newItemModal');
      resetItemsForm();
      updateAll();
    }

    function resetItemsForm() {
      document.getElementById('itemsList').innerHTML = `
        <div class="item-row">
          <div class="form-group"><label class="form-label">Description <span class="required">*</span></label><input type="text" class="form-input item-desc" placeholder="Item description"></div>
          <div class="form-group"><label class="form-label">Category</label><select class="form-input item-category"><option value="electronics">Electronics</option><option value="clothing">Clothing</option><option value="furniture">Furniture</option><option value="appliances">Appliances</option><option value="household">Household</option><option value="other">Other</option></select></div>
          <div class="form-group"><label class="form-label">Weight (lbs)</label><input type="number" class="form-input item-weight" placeholder="0"></div>
          <div class="form-group"><label class="form-label">Value ($)</label><input type="number" class="form-input item-value" placeholder="0"></div>
          <button class="remove-item-btn" onclick="removeItemRow(this)" style="visibility:hidden;"><svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
        </div>`;
      document.getElementById('itemCustomer').value = '';
    }

    // Delete item
    async function deleteItem(itemId, dbId) {
      if (!confirm('Delete this item?')) return;
      
      if (isSupabaseConfigured()) {
        await supabase.from('inventory').delete().eq('id', dbId);
      }
      inventory = inventory.filter(i => i.id !== dbId);
      updateAll();
    }

    // Navigation
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', function() {
        const page = this.dataset.page;
        if (!page) return;
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        this.classList.add('active');
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(page).classList.add('active');
      });
    });

    // Modals
    function openModal(id) {
      document.getElementById(id).classList.add('active');
      populateDropdowns();
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
    }

    document.querySelectorAll('.modal-overlay').forEach(m => {
      m.addEventListener('click', function(e) { if (e.target === this) this.classList.remove('active'); });
    });

    function addItemRow() {
      const list = document.getElementById('itemsList');
      const row = document.createElement('div');
      row.className = 'item-row';
      row.innerHTML = `
        <div class="form-group"><label class="form-label">Description <span class="required">*</span></label><input type="text" class="form-input item-desc" placeholder="Item description"></div>
        <div class="form-group"><label class="form-label">Category</label><select class="form-input item-category"><option value="electronics">Electronics</option><option value="clothing">Clothing</option><option value="furniture">Furniture</option><option value="appliances">Appliances</option><option value="household">Household</option><option value="other">Other</option></select></div>
        <div class="form-group"><label class="form-label">Weight (lbs)</label><input type="number" class="form-input item-weight" placeholder="0"></div>
        <div class="form-group"><label class="form-label">Value ($)</label><input type="number" class="form-input item-value" placeholder="0"></div>
        <button class="remove-item-btn" onclick="removeItemRow(this)"><svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>`;
      list.appendChild(row);
    }

    function removeItemRow(btn) { btn.closest('.item-row').remove(); }

    // Populate dropdowns
    function populateDropdowns() {
      ['itemCustomer', 'declarationCustomer', 'customerFilter'].forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        const first = el.options[0].outerHTML;
        el.innerHTML = first;
        customers.forEach(c => {
          el.innerHTML += `<option value="${c.customer_id}">${c.first_name} ${c.last_name} (${c.customer_id})</option>`;
        });
      });
    }

    // Stats calculation
    function getCustomerStats() {
      const stats = {};
      inventory.forEach(item => {
        if (!stats[item.customer_id]) stats[item.customer_id] = { items: 0, weight: 0, value: 0 };
        stats[item.customer_id].items++;
        stats[item.customer_id].weight += item.weight || 0;
        stats[item.customer_id].value += item.value || 0;
      });
      return stats;
    }

    // Render functions
    function renderRecentShipments() {
      const tbody = document.getElementById('recentShipmentsTable');
      const stats = getCustomerStats();
      tbody.innerHTML = customers.slice(0, 5).map(c => {
        const s = stats[c.customer_id] || { items: 0, weight: 0, value: 0 };
        return `<tr>
          <td><div class="customer-cell"><div class="customer-avatar">${c.first_name[0]}${c.last_name[0]}</div><div class="customer-info"><div class="name">${c.first_name} ${c.last_name}</div><div class="id">${c.customer_id}</div></div></div></td>
          <td>${s.items}</td><td class="weight-cell">${s.weight} lbs</td><td class="value-cell">$${s.value.toLocaleString()}</td>
          <td><span class="status-badge received"><span class="status-dot"></span>Received</span></td>
        </tr>`;
      }).join('') || '<tr><td colspan="5" style="text-align:center;color:var(--text-muted);padding:40px;">No customers yet</td></tr>';
    }

    function renderCustomersTable() {
      const tbody = document.getElementById('customersTable');
      const stats = getCustomerStats();
      tbody.innerHTML = customers.map(c => {
        const s = stats[c.customer_id] || { items: 0, weight: 0, value: 0 };
        return `<tr>
          <td><div class="customer-cell"><div class="customer-avatar">${c.first_name[0]}${c.last_name[0]}</div><div class="customer-info"><div class="name">${c.first_name} ${c.last_name}</div><div class="id">${c.customer_id}</div></div></div></td>
          <td>${c.phone}</td><td>${c.recipient_name}</td>
          <td>${s.items}</td><td class="weight-cell">${s.weight} lbs</td><td class="value-cell">$${s.value.toLocaleString()}</td>
          <td><div class="actions-cell"><button class="action-btn"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg></button></div></td>
        </tr>`;
      }).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--text-muted);padding:40px;">No customers yet. Add your first customer!</td></tr>';
    }

    function renderInventoryTable() {
      const tbody = document.getElementById('inventoryTable');
      let filtered = [...inventory];
      const catF = document.getElementById('categoryFilter').value;
      const statF = document.getElementById('statusFilter').value;
      const custF = document.getElementById('customerFilter').value;
      if (catF) filtered = filtered.filter(i => i.category === catF);
      if (statF) filtered = filtered.filter(i => i.status === statF);
      if (custF) filtered = filtered.filter(i => i.customer_id === custF);

      tbody.innerHTML = filtered.map(item => {
        const c = customers.find(cu => cu.customer_id === item.customer_id);
        return `<tr>
          <td style="font-family:'Space Mono',monospace;font-size:12px;">${item.item_id}</td>
          <td>${c ? `${c.first_name} ${c.last_name}` : item.customer_id}</td>
          <td>${item.description}</td>
          <td style="text-transform:capitalize;">${item.category}</td>
          <td class="weight-cell">${item.weight} lbs</td>
          <td class="value-cell">$${(item.value || 0).toLocaleString()}</td>
          <td><span class="status-badge ${item.status}"><span class="status-dot"></span>${item.status}</span></td>
          <td><div class="actions-cell"><button class="action-btn danger" onclick="deleteItem('${item.item_id}', ${item.id})"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button></div></td>
        </tr>`;
      }).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--text-muted);padding:40px;">No items yet</td></tr>';

      const tI = filtered.length, tW = filtered.reduce((s,i)=>s+(i.weight||0),0), tV = filtered.reduce((s,i)=>s+(i.value||0),0);
      document.getElementById('totalItems').textContent = tI;
      document.getElementById('totalWeight').textContent = `${tW.toLocaleString()} lbs`;
      document.getElementById('totalValue').textContent = `$${tV.toLocaleString()}`;
    }

    function renderShipmentsTable() {
      const tW = inventory.reduce((s,i)=>s+(i.weight||0),0);
      const tV = inventory.reduce((s,i)=>s+(i.value||0),0);
      document.getElementById('shipmentsTable').innerHTML = `
        <tr>
          <td style="font-family:'Space Mono',monospace;font-weight:600;">SHP-2026-001</td>
          <td style="font-family:'Space Mono',monospace;font-size:12px;">PENDING</td>
          <td>${customers.length}</td><td>${inventory.length}</td>
          <td class="weight-cell">${tW.toLocaleString()} lbs</td>
          <td class="value-cell">$${tV.toLocaleString()}</td>
          <td>Feb 8, 2026</td>
          <td><span class="status-badge staging"><span class="status-dot"></span>Staging</span></td>
        </tr>`;
    }

    function previewDeclaration() {
      const cId = document.getElementById('declarationCustomer').value;
      const preview = document.getElementById('declarationPreview');
      if (!cId) { preview.innerHTML = `<h4>CUSTOMS DECLARATION</h4><p style="text-align:center;color:#666;">Select a customer</p>`; return; }
      const c = customers.find(cu => cu.customer_id === cId);
      const items = inventory.filter(i => i.customer_id === cId);
      const tW = items.reduce((s,i)=>s+(i.weight||0),0), tV = items.reduce((s,i)=>s+(i.value||0),0);
      preview.innerHTML = '<h4>CUSTOMS DECLARATION</h4>' +
        '<div style="margin-bottom:16px;"><strong>Shipper:</strong> ' + c.first_name + ' ' + c.last_name + '<br><strong>Recipient:</strong> ' + c.recipient_name + '<br><strong>Destination:</strong> ' + c.recipient_address + '</div>' +
        '<div style="border-top:1px solid #e8e0c0;padding-top:12px;"><strong>Items:</strong></div>' +
        items.map(function(i) { return '<div class="declaration-row"><span>' + i.description + '</span><span>$' + (i.value||0) + '</span></div>'; }).join('') +
        '<div class="declaration-row"><span><strong>TOTAL (' + items.length + ' items, ' + tW + ' lbs)</strong></span><span><strong>$' + tV.toLocaleString() + '</strong></span></div>';
    }

    function exportInventory() {
      let csv = 'Item ID,Customer ID,Description,Category,Weight,Value,Status\n';
      inventory.forEach(i => { csv += `${i.item_id},${i.customer_id},"${i.description}",${i.category},${i.weight},${i.value},${i.status}\n`; });
      const blob = new Blob([csv], {type:'text/csv'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `inventory_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
    }

    function updateStats() {
      const tW = inventory.reduce((s,i)=>s+(i.weight||0),0);
      const tV = inventory.reduce((s,i)=>s+(i.value||0),0);
      document.getElementById('statWeight').textContent = `${tW.toLocaleString()} lbs`;
      document.getElementById('statCapacity').textContent = `↑ ${Math.round(tW/4000*100)}% capacity`;
      document.getElementById('statCustomers').textContent = customers.length;
      document.getElementById('statValue').textContent = `$${tV.toLocaleString()}`;
      document.getElementById('statItems').textContent = inventory.length;
      document.getElementById('customerCount').textContent = customers.length;
      document.getElementById('inventoryCount').textContent = inventory.length;
    }

    function updateAll() {
      updateStats();
      populateDropdowns();
      renderRecentShipments();
      renderCustomersTable();
      renderInventoryTable();
      renderShipmentsTable();
    }

    document.getElementById('categoryFilter')?.addEventListener('change', renderInventoryTable);
    document.getElementById('statusFilter')?.addEventListener('change', renderInventoryTable);
    document.getElementById('customerFilter')?.addEventListener('change', renderInventoryTable);

    // Initialize
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
